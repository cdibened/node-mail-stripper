// Generated by CoffeeScript 2.4.1
(function() {
  var MailStripper;

  MailStripper = (function() {
    class MailStripper {
      constructor(opts) {
        this.opts = opts;
        if (this.opts.patterns) {
          this.patterns = this.patterns.concat(this.opts.patterns);
        }
      }

      lineShouldBeStripped(line) {
        var i, len, pattern, ref;
        ref = this.patterns;
        for (i = 0, len = ref.length; i < len; i++) {
          pattern = ref[i];
          if (pattern.test(line)) {
            return true;
          }
        }
        return false;
      }

      lineContainsName(line, name) {
        var name_re;
        name_re = new RegExp(`^\\s*${name}\\s*`, 'i');
        return name_re.test(line);
      }

      parse(body, name) {
        var i, len, line, lines, message_lines, type;
        lines = body.replace(/\r\n/g, '\n').split('\n');
        message_lines = [];
        for (i = 0, len = lines.length; i < len; i++) {
          line = lines[i];
          type = this.lineShouldBeStripped(line);
          if (name) {
            type = type || this.lineContainsName(line, name);
          }
          if (!type) {
            message_lines.push(line);
          } else {
            break;
          }
        }
        while (message_lines.length > 0 && message_lines[message_lines.length - 1] === '') {
          message_lines.pop();
        }
        return message_lines.join('\n');
      }

    };

    MailStripper.prototype.patterns = [/^\s*--/, /\d{4}-\d{2}-\d{2} \d{2}:\d{2} GMT\+\d{2}:\d{2}/, /^â€”/, /<[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,8}>/i, /^\s*~~/, /^\s*~~~/];

    return MailStripper;

  }).call(this);

  module.exports = MailStripper;

}).call(this);
